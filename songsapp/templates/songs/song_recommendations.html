{% extends 'base.html' %}

{% block title %}Similar Songs - {{ song.title }} - Sonyc{% endblock %}

{% block content %}
    <h1>Similar Songs to "{{ song.title }}"</h1>
    
    <div class="song-grid">
        {% for recommended_song in recommended_songs %}
            <div class="song-card">
                <div class="song-image-container">
                    <img src="{{ recommended_song.image.url }}" alt="{{ recommended_song.title }}" class="song-image">
                    <div class="song-overlay">
                        <button class="btn btn-primary view-btn" onclick="window.location.href='{% url 'songsapp:song_detail' recommended_song.id %}'">
                            <i class="fas fa-info-circle"></i>
                            View Details
                        </button>
                    </div>
                </div>
                <div class="song-info">
                    <h3 class="song-title">{{ recommended_song.title }}</h3>
                    <div class="song-meta">
                        {% if recommended_song.movie_name %}
                            <span class="meta-item">
                                <i class="fas fa-film"></i>
                                {{ recommended_song.movie_name }}
                            </span>
                        {% endif %}
                        <span class="meta-item">
                            <i class="fas fa-microphone"></i>
                            {{ recommended_song.singer }}
                        </span>
                        <span class="meta-item">
                            <i class="fas fa-music"></i>
                            {{ recommended_song.genre }}
                        </span>
                    </div>
                    <div class="audio-player">
                        <audio controls style="width: 100%;" data-song-id="{{ recommended_song.id }}">
                            <source src="{{ recommended_song.audio_file.url }}" type="audio/mpeg">
                            Your browser does not support the audio element.
                        </audio>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>

    <div style="margin-top: 3rem;">
        <a href="{% url 'songsapp:song_detail' song.id %}" class="back-link">
            <i class="fas fa-arrow-left"></i>
            Back to Song
        </a>
    </div>

<style>
    .song-image-container {
        position: relative;
        overflow: hidden;
        border-radius: var(--border-radius) var(--border-radius) 0 0;
    }

    .song-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(108, 99, 255, 0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: var(--transition);
    }

    .song-card:hover .song-overlay {
        opacity: 1;
    }

    .view-btn {
        background: var(--surface);
        color: var(--primary);
        padding: 0.75rem 1.5rem;
        border-radius: 50px;
        font-weight: 600;
        transform: translateY(20px);
        transition: var(--transition);
    }

    .song-card:hover .view-btn {
        transform: translateY(0);
    }

    .meta-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--text-secondary);
        font-size: 0.9rem;
    }

    .meta-item i {
        color: var(--primary);
        width: 16px;
    }

    .audio-player {
        background: var(--surface);
        padding: 1rem;
        border-radius: var(--border-radius);
        margin-top: 1rem;
        box-shadow: var(--shadow-sm);
        transition: var(--transition);
    }

    .audio-player audio {
        width: 100%;
        height: 36px;
        border-radius: 18px;
    }

    .audio-player.playing {
        background: var(--primary);
        box-shadow: var(--shadow-md);
    }

    .audio-player.playing audio::-webkit-media-controls-panel {
        background: var(--primary-dark);
    }

    .song-card {
        background: var(--surface);
        border-radius: var(--border-radius);
        overflow: hidden;
        transition: var(--transition);
        box-shadow: var(--shadow-sm);
    }

    .song-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--shadow-lg);
    }

    .song-image {
        width: 100%;
        height: 250px;
        object-fit: cover;
        transition: var(--transition);
    }

    .song-card:hover .song-image {
        transform: scale(1.05);
    }

    .song-info {
        padding: 1.5rem;
    }

    .song-title {
        font-size: 1.25rem;
        margin-bottom: 1rem;
        color: var(--text-primary);
        font-weight: 600;
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Function to stop all other audio players
    function stopOtherPlayers(currentPlayer) {
        const allPlayers = document.querySelectorAll('audio');
        allPlayers.forEach(player => {
            if (player !== currentPlayer && !player.paused) {
                player.pause();
                player.currentTime = 0;
                const playerContainer = player.closest('.audio-player');
                if (playerContainer) {
                    playerContainer.classList.remove('playing');
                }
            }
        });
    }

    // Add event listeners to all audio players
    const audioPlayers = document.querySelectorAll('audio');
    audioPlayers.forEach(player => {
        player.addEventListener('play', function() {
            stopOtherPlayers(this);
            const playerContainer = this.closest('.audio-player');
            if (playerContainer) {
                playerContainer.classList.add('playing');
            }
        });

        player.addEventListener('pause', function() {
            const playerContainer = this.closest('.audio-player');
            if (playerContainer) {
                playerContainer.classList.remove('playing');
            }
        });

        player.addEventListener('ended', function() {
            const playerContainer = this.closest('.audio-player');
            if (playerContainer) {
                playerContainer.classList.remove('playing');
            }
        });
    });
});
</script>
{% endblock %} 